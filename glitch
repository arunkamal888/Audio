import javax.sound.sampled.*;
import java.io.File;
import java.io.IOException;

public class AudioQualityChecker {

    private static final double SNR_THRESHOLD = 15; // SNR threshold for good quality
    private static final double ENERGY_THRESHOLD_FACTOR = 0.5; // Factor of average energy considered as threshold

    public static void main(String[] args) {
        String filePath = "path_to_your_audio_file.wav"; // Specify the path to your audio file
        File audioFile = new File(filePath);
        try {
            AudioInputStream audioInputStream = AudioSystem.getAudioInputStream(audioFile);
            AudioFormat format = audioInputStream.getFormat();
            double[] samples = extractSamples(audioInputStream, format);

            boolean[] voiceActive = detectVoice(samples, format);
            double snr = calculateSNR(samples, voiceActive);

            System.out.println("SNR: " + snr + " dB");
            System.out.println("Audio Quality: " + (snr > SNR_THRESHOLD ? "Good" : "Not Good"));
        } catch (UnsupportedAudioFileException | IOException e) {
            e.printStackTrace();
        }
    }

    private static double[] extractSamples(AudioInputStream stream, AudioFormat format) throws IOException {
        byte[] audioBytes = stream.readAllBytes();
        double[] samples = new double[audioBytes.length / 2];
        for (int i = 0, sampleIndex = 0; i < audioBytes.length; sampleIndex++, i += 2) {
            int sample = ((audioBytes[i + 1] & 0xFF) << 8) | (audioBytes[i] & 0xFF);
            samples[sampleIndex] = sample / 32768.0; // Normalize to range [-1,1] for 16-bit audio
        }
        return samples;
    }

    private static boolean[] detectVoice(double[] samples, AudioFormat format) {
        int sampleRate = (int) format.getFrameRate();
        int frameSize = sampleRate / 10; // 100ms frames
        double[] energies = new double[samples.length / frameSize];
        double avgEnergy = 0;

        for (int i = 0, frameStart = 0; frameStart < samples.length; i++, frameStart += frameSize) {
            double sumEnergy = 0;
            for (int j = frameStart; j < frameStart + frameSize && j < samples.length; j++) {
                sumEnergy += samples[j] * samples[j];
            }
            energies[i] = sumEnergy / frameSize;
            avgEnergy += energies[i];
        }
        avgEnergy /= (samples.length / frameSize);

        boolean[] voiceActive = new boolean[samples.length];
        double energyThreshold = avgEnergy * ENERGY_THRESHOLD_FACTOR;
        for (int i = 0, frameStart = 0; frameStart < samples.length; i++, frameStart += frameSize) {
            if (energies[i] > energyThreshold) {
                for (int j = frameStart; j < frameStart + frameSize && j < samples.length; j++) {
                    voiceActive[j] = true;
                }
            }
        }
        return voiceActive;
    }

    private static double calculateSNR(double[] samples, boolean[] voiceActive) {
        double signalPower = 0, noisePower = 0;
        int signalCount = 0, noiseCount = 0;

        for (int i = 0; i < samples.length; i++) {
            if (voiceActive[i]) {
                signalPower += samples[i] * samples[i];
                signalCount++;
            } else {
                noisePower += samples[i] * samples[i];
                noiseCount++;
            }
        }

        double avgSignalPower = (signalCount > 0) ? signalPower / signalCount : 0;
        double avgNoisePower = (noiseCount > 0) ? noisePower
